(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-52485e3b"],{b0411:function(e,s,t){"use strict";t.r(s);var o=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"main1"},[t("div",{staticClass:"main_down1"},[t("div",{staticClass:"left"},[t("div",{staticClass:"left_up"},[t("div",{staticClass:"label_title"},[e._v(" 已建立会话 ")]),e._l(e.sessionList_already,(function(s){return t("div",{key:s.id,class:e.curSessionId==s.id?"box_select":"box"},[t("div",{staticClass:"right_left_del"},[t("a-popconfirm",{attrs:{title:"确认断开连接？","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(t){return e.delSession(s.phone)}}},[t("a-icon",{attrs:{type:"close-circle"}})],1)],1),t("div",{staticClass:"box_left",on:{click:function(t){return e.startSession(s.phone,s.username)}}},[e._v(" "+e._s(s.username)+" ")]),t("div",{staticClass:"right_left"},[t("div",{staticClass:"right_left_count"},[e._v(" "+e._s(s.unread)+" ")])])])}))],2)]),t("div",{staticClass:"right"},[t("div",{staticClass:"right_top_user"},[e._v(" "+e._s(e.curToName)+" ")]),t("div",{ref:"element",staticClass:"up",attrs:{id:"msg_end"}},e._l(e.list,(function(s,o){return t("div",{key:o,class:s.fromUserId===e.curUserId?"msg_right":"msg_left"},[t("div",{staticClass:"msg_right_up"},[e._v(" "+e._s(s.fromUserId===e.curUserId?e.curUserName:e.curToName)+" ")]),t("div",{class:s.fromUserId===e.curUserId?"msg_right_down":"msg_left_down"},[e._v(" "+e._s(s.content)+" ")])])})),0),t("div",{staticClass:"down"},[t("a-textarea",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:9,placeholder:"请输入内容，回车发送！"},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMsg.apply(null,arguments)}},model:{value:e.textarea,callback:function(s){e.textarea=s},expression:"textarea"}})],1)])])])},i=[],r=t("5530"),n=t("93d6"),c=t("5880"),a="小王",l="小夏",u={name:"talkSystem",data:function(){return{chatUser:a,myUser:l,dialogVisible:!1,dialogTitle:"",loginName:"",textarea:"",list:[],curUserId:"",curUserName:"",curToID:"",curToName:"",sessionList_already:[]}},computed:Object(r["a"])({},Object(c["mapGetters"])("account",["user","id"])),mounted:function(){var e=this;e.curUserId=this.user,console.log("this.user"),console.log(this.user),e.dialogVisible=!1,e.sessionListAlready()},updated:function(){var e=document.getElementById("msg_end");e.scrollTop=e.scrollHeight},destroyed:function(){this.websocketclose()},methods:{initWebSocket:function(e,s){this.websock=new WebSocket("ws://localhost:8080/websocket/"+e+"/"+s),console.log(1111),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose,console.log(2222)},websocketonopen:function(){console.log("WebSocket连接成功")},websocketonerror:function(e){console.log("WebSocket连接发生错误",e)},websocketonmessage:function(e){var s=JSON.parse(e.data);s instanceof Array?this.sessionList_already=s:this.list.push(s)},websocketclose:function(){void 0!=this.websock&&this.websock.close()},sendMsg:function(){if(""==this.curToID)return this.$message.error("请选择左边的对话框开始聊天!");var e={fromUserId:this.curUserId,fromUserName:this.curUserName,content:this.textarea};this.list.push(e),this.websock.send(this.textarea),this.textarea=""},openDialog:function(e){this.dialogTitle=e,this.dialogVisible=!0},sessionListAlready:function(){var e=this;Object(n["p"])(this.curUserId).then((function(s){e.sessionList_already=s.data.result}))},startSession:function(e,s){console.log(this.websock),void 0!=this.websock&&this.websock.close(),this.curToID=e,this.curToName=s,this.msgList(),this.initWebSocket(this.curUserId,e)},delSession:function(e){this.curToID==e&&(this.websock.close(),this.curToID="",this.curToName=""),Object(n["i"])(this.curUserId,e).then((function(e){console.log(e)})),this.sessionListAlready()},msgList:function(){var e=this;Object(n["n"])(this.curUserId,this.curToID).then((function(s){console.log(s),e.list=[];for(var t=0;t<s.data.result.length;t++){var o=s.data.result[t];""==e.curUserName&&(o.fromUserPhone==e.curUserId?e.curUserName=o.fromUserName:e.curUserName=o.toUserName),console.log(o.fromUserId),console.log(e.curRealID),console.log(e.user);var i={fromUserId:o.fromUserPhone,fromUserName:o.fromUserName,content:o.content};e.list.push(i)}}))}}},d=u,h=(t("fc68"),t("2877")),f=Object(h["a"])(d,o,i,!1,null,"02df73ec",null);s["default"]=f.exports},db8e:function(e,s,t){},fc68:function(e,s,t){"use strict";t("db8e")}}]);