(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-360db2d9"],{"9d3d":function(s,e,t){},b0411:function(s,e,t){"use strict";t.r(e);var i=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"main1"},[t("div",{staticClass:"main_down1"},[t("div",{staticClass:"left"},[t("div",{staticClass:"left_up"},[t("div",{staticClass:"label_title"},[s._v(" 已建立会话 ")]),s._l(s.sessionList_already,(function(e){return t("div",{key:e.id,class:s.curSessionId==e.id?"box_select":"box"},[t("div",{staticClass:"box_left",on:{click:function(t){return s.startSession(e.id)}}},[s._v(" "+s._s(e.listName)+" ")]),t("div",{staticClass:"right_left"},[t("div",{staticClass:"right_left_count"},[s._v(" "+s._s(e.unReadCount)+" ")]),t("div",{staticClass:"right_left_del"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return s.delSession(e.id)}}})])])])}))],2),t("div",{staticClass:"left_down"},[t("div",{staticClass:"label_title"},[s._v(" 可建立会话 ")]),s._l(s.sessionList_not,(function(e){return t("div",{key:e.id,staticClass:"box",on:{click:function(t){return s.createSession(e.id,e.name)}}},[t("div",{staticClass:"box_left"},[s._v(" "+s._s(e.name)+" ")])])}))],2)]),t("div",{staticClass:"right"},[t("div",{ref:"element",staticClass:"up",attrs:{id:"msg_end"}},s._l(s.list,(function(e,i){return t("div",{key:i,class:e.fromUserId===s.curUserId?"msg_right":"msg_left"},[t("div",{staticClass:"msg_right_up"},[s._v(" "+s._s(e.fromUserName)+" ")]),t("div",{class:e.fromUserId===s.curUserId?"msg_right_down":"msg_left_down"},[s._v(" "+s._s(e.content)+" ")])])})),0),t("div",{staticClass:"down"},[t("a-textarea",{attrs:{type:"textarea",rows:9,placeholder:"请输入内容，回车发送！"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter")?null:s.sendMsg.apply(null,arguments)}},model:{value:s.textarea,callback:function(e){s.textarea=e},expression:"textarea"}})],1)])])])},o=[],n=(t("b0c0"),t("cebe")),a=t.n(n),r={name:"talkSystem",data:function(){return{dialogVisible:!1,dialogTitle:"",loginName:"",textarea:"",list:[],curUserId:"",curUserName:"",curSessionId:"",sessionList_already:[],sessionList_not:[]}},created:function(){},mounted:function(){var s=this.$route.query.id,e=decodeURIComponent(s),t=JSON.parse(e);this.loginName=t;var i=this;a.a.get("http://127.0.0.1:1997/login?name="+this.loginName).then((function(s){if(console.log(s.data),-1==s.data.code)return i.$message.error(s.data.errDesc);i.curUserId=s.data.data.id,i.curUserName=s.data.data.name,i.dialogVisible=!1,i.getSessionListNot(),i.sessionListAlready(),i.startSession(99999999)})).catch((function(s){console.log(s)}))},updated:function(){var s=document.getElementById("msg_end");s.scrollTop=s.scrollHeight},destroyed:function(){this.websocketclose()},methods:{initWebSocket:function(s,e){this.websock=new WebSocket("ws://127.0.0.1:1997/websocket/"+s+"/"+e),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonopen:function(){console.log("WebSocket连接成功")},websocketonerror:function(s){console.log("WebSocket连接发生错误",s)},websocketonmessage:function(s){var e=JSON.parse(s.data);e instanceof Array?this.sessionList_already=e:this.list.push(e)},websocketclose:function(s){null!=this.curUserId&&(null!=this.curSessionId?this.initWebSocket(this.curUserId,this.curSessionId):this.initWebSocket(this.curUserId,99999999)),console.log("connection closed",s),console.log(s)},sendMsg:function(){if(""==this.curSessionId)return this.$message.error("请选择左边的对话框开始聊天!");var s={fromUserId:this.curUserId,fromUserName:this.curUserName,content:this.textarea};this.list.push(s),this.websock.send(this.textarea),this.textarea=""},openDialog:function(s){this.dialogTitle=s,this.dialogVisible=!0},getSessionListNot:function(){var s=this;a.a.get("http://127.0.0.1:1997/sessionList/not?id="+this.curUserId).then((function(e){if(-1==e.data.code)return s.$message.error(e.data.errDesc);s.sessionList_not=e.data.data})).catch((function(s){console.log(s)}))},sessionListAlready:function(){var s=this;a.a.get("http://127.0.0.1:1997/sessionList/already?id="+this.curUserId).then((function(e){if(-1==e.data.code)return s.$message.error(e.data.errDesc);s.sessionList_already=e.data.data})).catch((function(s){console.log(s)}))},createSession:function(s,e){var t=this;a.a.get("http://127.0.0.1:1997/createSession?id="+this.curUserId+"&toUserId="+s+"&toUserName="+e).then((function(s){if(-1==s.data.code)return t.$message.error(s.data.errDesc);t.getSessionListNot(),t.sessionListAlready()})).catch((function(s){console.log(s)}))},startSession:function(s){console.log(this.websock),void 0!=this.websock&&this.websock.close(),this.curSessionId=s,this.initWebSocket(this.curUserId,s),this.msgList(s)},delSession:function(s){var e=this;a.a.get("http://127.0.0.1:1997/delSession?sessionId="+s).then((function(s){if(-1==s.data.code)return e.$message.error(s.data.errDesc);e.getSessionListNot(),e.sessionListAlready()})).catch((function(s){console.log(s)}))},loginOut:function(){var s=this;a.a.get("http://127.0.0.1:1997/loginOut?name="+this.curUserName).then((function(e){return-1==e.data.code?s.$message.error(e.data.errDesc):(s.curUserId="",s.curUserName="",s.$message.success("退出登录成功"))})).catch((function(s){console.log(s)}))},msgList:function(s){var e=this;a.a.get("http://127.0.0.1:1997/msgList?sessionId="+s).then((function(s){if(-1==s.data.code)return e.$message.error(s.data.errDesc);e.list=s.data.data,e.sessionListAlready()})).catch((function(s){console.log(s)}))}}},c=r,d=(t("e7bb"),t("2877")),l=Object(d["a"])(c,i,o,!1,null,"6df72a65",null);e["default"]=l.exports},e7bb:function(s,e,t){"use strict";t("9d3d")}}]);